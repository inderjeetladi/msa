# Supabase Setup for Prompts Storage

This document explains how to set up Supabase for storing farmer prompts in the Missouri Soybean Association application.

## Prerequisites

1. A Supabase account (already created)
2. A Supabase project with the `prompts` table

## Database Table

The `prompts` table has been created with the following structure:

```sql
create table public.prompts (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  propmt text null,
  user_id uuid null,
  constraint prompts_pkey primary key (id)
) TABLESPACE pg_default;
```

## Environment Variables

Create a `.env.local` file in the root directory with your Supabase credentials:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### How to get your Supabase credentials:

1. Go to your Supabase project dashboard
2. Navigate to Settings > API
3. Copy the following values:
   - **Project URL** → `NEXT_PUBLIC_SUPABASE_URL`
   - **Project API keys > anon public** → `NEXT_PUBLIC_SUPABASE_ANON_KEY`

## Implementation Details

### Files Created/Modified:

1. **`src/lib/supabase.ts`** - Supabase client configuration
2. **`src/services/promptsService.ts`** - Service for database operations
3. **`src/app/farmer-facing/page.tsx`** - Updated to save prompts after successful API calls

### How it works:

1. When a user submits a question on the farmer-facing page
2. The question is sent to the `/api/chat` endpoint
3. If the API call is successful, the prompt is automatically saved to the database
4. The prompt is saved with:
   - `propmt`: The question text
   - `user_id`: null (for anonymous users)
   - `created_at`: Current timestamp (auto-generated)

### Database Operations Available:

- `PromptsService.savePrompt(prompt, userId?)` - Save a new prompt
- `PromptsService.getUserPrompts(userId)` - Get prompts for a specific user
- `PromptsService.getAllPrompts()` - Get all prompts (admin use)

## Testing

To test the implementation:

1. Set up your `.env.local` file with correct Supabase credentials
2. Start the development server: `npm run dev`
3. Navigate to `/farmer-facing`
4. Submit a question
5. Check your Supabase dashboard to see the prompt saved in the `prompts` table

## Security Notes

- The implementation uses the anon key, which is safe for client-side use
- User authentication can be added later by implementing Supabase Auth
- Row Level Security (RLS) can be enabled on the prompts table for additional security
